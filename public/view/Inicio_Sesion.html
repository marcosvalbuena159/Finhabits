<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinHabits | Inicio de Sesión</title>
    <link rel="stylesheet" href="/Css/loginYRegistro.css">
    <link rel="stylesheet" href="/Css/Index.css">
    <link rel="stylesheet" href="/Css/Login.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.1/css/all.css" crossorigin="anonymous">
</head>

<body>
    <section class="container">
        <section class="izquierda">
            <a href="home" class="back-home">
                <i class="fas fa-arrow-left"></i>
                Volver al inicio
            </a>

            <!-- Área de alertas -->
            <div id="alertContainer"></div>

            <form class="auth-form" id="loginForm" action="/usuarios/login" method="POST" accept-charset="utf-8">
                <h1>Inicia Sesión</h1>
                <p class="subtitle">Bienvenido de vuelta, administra tus finanzas de manera inteligente</p>

                <div class="form-group" id="emailGroup">
                    <input type="email" name="correo" id="correo" placeholder="Correo Electrónico" required>
                    <div class="field-error" id="emailError" style="display: none;"></div>
                </div>

                <div class="form-group password-field" id="passwordGroup">
                    <input type="password" id="passwordInput" name="contrasena" placeholder="Contraseña" required>
                    <button type="button" class="toggle-password">
                        <i class="fas fa-eye" id="toggleIcon"></i>
                    </button>
                    <div class="field-error" id="passwordError" style="display: none;"></div>
                </div>

                <div class="form-options">
                    <div class="checkbox-group">
                        <input type="checkbox" id="recordar" name="recordar">
                        <label for="recordar">Recordar sesión</label>
                    </div>
                    <a href="#" class="forgot-password">¿Olvidaste tu contraseña?</a>
                </div>

                <button type="submit" class="btn-primary" id="submitBtn">
                    INICIAR SESIÓN
                </button>

                <h5>¿No tienes cuenta? <a href="Registro">Regístrate Aquí</a></h5>

                <div class="divider">
                    <span>o inicia sesión con</span>
                </div>

                <div class="social-auth-row">
                    <button type="button" class="btn-social btn-google">
                        <i class="fab fa-google"></i>
                        Continuar con Google
                    </button>
                    <button type="button" class="btn-social btn-apple">
                        <i class="fab fa-apple"></i>
                        Continuar con Apple
                    </button>
                </div>
            </form>
        </section>

        <section class="derecha">
            <div class="logo">FinHabits</div>
            <h2>Bienvenido de vuelta</h2>
            <p>Continúa transformando tu futuro financiero. Accede a tu dashboard personalizado y mantén el control
                total de tus finanzas.</p>

            <div class="features-list">
                <div class="feature-item">
                    <i class="fas fa-chart-line"></i>
                    <span>Dashboard personalizado</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-piggy-bank"></i>
                    <span>Seguimiento de metas</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-bell"></i>
                    <span>Alertas inteligentes</span>
                </div>
            </div>
        </section>
    </section>
    <script>
        // Sistema de alertas mejorado
        function showAlert(message, type = 'info', duration = 5000) {
            const alertContainer = document.getElementById('alertContainer');
            
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-triangle',
                warning: 'fas fa-exclamation-circle',
                info: 'fas fa-info-circle'
            };

            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <i class="alert-icon ${icons[type]}"></i>
                <span>${message}</span>
                <button class="alert-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;

            alertContainer.appendChild(alert);

            // Auto-remove después del tiempo especificado
            if (duration > 0) {
                setTimeout(() => {
                    if (alert.parentElement) {
                        alert.style.animation = 'slideOut 0.3s ease-out forwards';
                        setTimeout(() => alert.remove(), 300);
                    }
                }, duration);
            }
        }

        // Validación mejorada de campos
        function validateField(field, errorElement, validationFn, errorMessage) {
            const isValid = validationFn(field.value);
            const group = field.closest('.form-group');
            
            if (!isValid) {
                group.classList.add('error');
                group.classList.remove('success');
                errorElement.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${errorMessage}`;
                errorElement.style.display = 'flex';
                return false;
            } else {
                group.classList.remove('error');
                group.classList.add('success');
                errorElement.style.display = 'none';
                return true;
            }
        }

        // Toggle password visibility
        document.querySelector('.toggle-password').addEventListener('click', function () {
            const passwordInput = document.getElementById('passwordInput');
            const toggleIcon = document.getElementById('toggleIcon');

            const isPassword = passwordInput.type === 'password';
            passwordInput.type = isPassword ? 'text' : 'password';

            toggleIcon.classList.toggle('fa-eye');
            toggleIcon.classList.toggle('fa-eye-slash');
        });

        // Validación en tiempo real
        const emailField = document.getElementById('correo');
        const passwordField = document.getElementById('passwordInput');
        const emailError = document.getElementById('emailError');
        const passwordError = document.getElementById('passwordError');

        emailField.addEventListener('blur', function() {
            validateField(
                this, 
                emailError, 
                value => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value),
                'Por favor ingresa un correo electrónico válido'
            );
        });

        passwordField.addEventListener('blur', function() {
            validateField(
                this, 
                passwordError, 
                value => value.length >= 6,
                'La contraseña debe tener al menos 6 caracteres'
            );
        });

        // Manejo del formulario
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.textContent;
            
            // Validar campos
            const emailValid = validateField(
                emailField, 
                emailError, 
                value => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value) && value.trim() !== '',
                'Por favor ingresa un correo electrónico válido'
            );
            
            const passwordValid = validateField(
                passwordField, 
                passwordError, 
                value => value.length >= 6,
                'La contraseña debe tener al menos 6 caracteres'
            );

            if (!emailValid || !passwordValid) {
                showAlert('Por favor corrige los errores en el formulario antes de continuar', 'error');
                return;
            }

            // Mostrar estado de carga
            submitBtn.textContent = 'INICIANDO SESIÓN...';
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;

            // Simular envío (aquí irían las credenciales reales)
            const formData = new FormData(this);
            
            // Simulación de respuesta del servidor
            setTimeout(() => {
                const correo = formData.get('correo');
                const contrasena = formData.get('contrasena');
                
                // Simular diferentes respuestas del servidor
                if (correo === 'test@test.com' && contrasena === '123456') {
                    showAlert('¡Bienvenido de vuelta! Iniciando sesión...', 'success');
                    setTimeout(() => {
                        window.location.href = '/dashboard';
                    }, 1500);
                } else if (correo === 'usuario@noexiste.com') {
                    showAlert('No encontramos una cuenta asociada a este correo electrónico. ¿Quizás necesitas crear una cuenta?', 'error');
                } else if (contrasena === 'wrongpass') {
                    showAlert('La contraseña ingresada es incorrecta. ¿Olvidaste tu contraseña?', 'error');
                } else {
                    showAlert('Credenciales incorrectas. Por favor verifica tu correo y contraseña.', 'error');
                }
                
                // Restaurar botón
                submitBtn.textContent = originalText;
                submitBtn.classList.remove('loading');
                submitBtn.disabled = false;
            }, 2000);
        });

        // Mensaje de bienvenida si viene de registro
        window.addEventListener('load', function() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('registered') === 'true') {
                showAlert('¡Cuenta creada exitosamente! Ahora puedes iniciar sesión con tus credenciales.', 'success');
            }
        });

        // Autocompletar mejorado
        emailField.addEventListener('input', function() {
            if (this.classList.contains('error')) {
                this.closest('.form-group').classList.remove('error');
                emailError.style.display = 'none';
            }
        });

        passwordField.addEventListener('input', function() {
            if (this.classList.contains('error')) {
                this.closest('.form-group').classList.remove('error');
                passwordError.style.display = 'none';
            }
        });

        // CSS adicional para animaciones
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideOut {
                to {
                    transform: translateY(-10px);
                    opacity: 0;
                    max-height: 0;
                    margin: 0;
                    padding: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>

</body>

</html>